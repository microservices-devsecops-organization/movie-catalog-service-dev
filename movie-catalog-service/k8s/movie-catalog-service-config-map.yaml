kind: ConfigMap
apiVersion: v1
metadata:
  name: movie-catalog-service-config-map
  annotations:
    author: DhiegoDuarte
    email: dhiegoduarte@gmail.com
    company: ClaroBR
  labels:
    application: movie-catalog-service
    revision: TODO_COMO_COLOCAR_O_COMMIT_AQUI #4c511f16ef2644854d04cabebfcecc82be0eb04f
    env: stage
    version: "1.0.0"
    owner: movies-squad
data:
  # Simulando uma conf para host de banco de dados
  db-host: database_hostname
#   jaeger-agent-host: claro-jaeger-agent 
  jaeger-agent-port: '6831'
  jaeger-service-name: movie-catalog-service
  application.yaml: |-
    # Actuator configurations https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#production-ready
    management.endpoints.web.exposure.include: '*'
    management.endpoint.health.show-details: always #never always
    # resilience4j configurations http://resilience4j.github.io/resilience4j/#_spring_boot_2_starter
    resilience4j.circuitbreaker:
        backends:
            ratings-data-service-circuitbreaker:
                registerHealthIndicator: true
                # The Ring Bit Buffer must be full, before the failure rate can be calculated. For example, if the size of the Ring Buffer is 10, then at least 10 calls must evaluated, before the failure rate can be calculated 
                ringBufferSizeInClosedState: 5 # the size of the ring buffer when the CircuitBreaker is closed
                ringBufferSizeInHalfOpenState: 3 # the size of the ring buffer when the CircuitBreaker is half open
                waitDurationInOpenState: 5000 # the wait duration which specifies how long the CircuitBreaker should stay open, before it switches to half open
                failureRateThreshold: 10 # the failure rate threshold in percentage above which the CircuitBreaker should trip open and start short-circuiting calls
                eventConsumerBufferSize: 10 # The size of a event consumer buffer can be configured per CircuitBreaker
                #ignoreExceptions: #  list of exceptions which should be ignored and not increase failure count
                    #- io.github.robwin.exception.BusinessException
                #recordExceptions: # a list of exceptions which should increase failure count
                    #- java.util.concurrent.TimeoutException  
            movie-info-service-circuitbreaker:
                registerHealthIndicator: true
                # The Ring Bit Buffer must be full, before the failure rate can be calculated. For example, if the size of the Ring Buffer is 10, then at least 10 calls must evaluated, before the failure rate can be calculated 
                ringBufferSizeInClosedState: 5 # the size of the ring buffer when the CircuitBreaker is closed
                ringBufferSizeInHalfOpenState: 3 # the size of the ring buffer when the CircuitBreaker is half open
                waitDurationInOpenState: 5000 # the wait duration which specifies how long the CircuitBreaker should stay open, before it switches to half open
                failureRateThreshold: 50 # the failure rate threshold in percentage above which the CircuitBreaker should trip open and start short-circuiting calls
                eventConsumerBufferSize: 10 # The size of a event consumer buffer can be configured per CircuitBreaker
                #ignoreExceptions: #  list of exceptions which should be ignored and not increase failure count
                    #- io.github.robwin.exception.BusinessException
                #recordExceptions: # a list of exceptions which should increase failure count
                    #- java.util.concurrent.TimeoutException         
    resilience4j.retry:
        backends:
            ratings-data-service-retry:
                maxRetryAttempts: 1
                waitDuration: 100
                #retryExceptions:
                #    - org.springframework.web.client.HttpServerErrorException
                #ignoreExceptions:
                #    - io.github.robwin.exception.BusinessException
            movie-info-service-retry:
                maxRetryAttempts: 1
                waitDuration: 100
                #retryExceptions:
                #    - org.springframework.web.client.HttpServerErrorException
                #ignoreExceptions:
                #    - io.github.robwin.exception.BusinessException
    resilience4j.bulkhead:
        backends:
            ratings-data-service-bulkhead:
                maxConcurrentCall: 10 # max amount of parallel executions allowed by the bulkhead
            movie-info-service-bulkhead:
                maxConcurrentCall: 10 # max amount of parallel executions allowed by the bulkhead
                                   
    resilience4j.ratelimiter:
        limiters:
            ratings-data-service-ratelimiter:
                registerHealthIndicator: true
                limit-refresh-period-in-millis: 1 # the period of limit refresh, after each period rate limiter sets its permissions count to limitForPeriod value
                limit-for-period: 10 # the permissions limit for refresh period
                timeout-in-millis: 25 # the default wait for permission duration
            movie-info-service-ratelimiter:
                registerHealthIndicator: true
                limit-refresh-period-in-millis: 1 # the period of limit refresh, after each period rate limiter sets its permissions count to limitForPeriod value
                limit-for-period: 10 # the permissions limit for refresh period
                timeout-in-millis: 25 # the default wait for permission duration   